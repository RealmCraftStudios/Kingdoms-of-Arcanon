<script>
document.addEventListener("DOMContentLoaded", function() {
    const splashScreen = document.getElementById('splash-screen');
    const mainContent = document.getElementById('main-content');
    const pageLinks = document.querySelectorAll('.page-link');
    const audioPlayer = document.getElementById('audio-player');
    const nextButton = document.getElementById('nextButton');
    const prevButton = document.getElementById('prevButton');

    let currentTrackIndex = 0;
    const tracks = [
        "https://raw.githubusercontent.com/RealmCraftStudios/Kingdoms-of-Arcanon/main/WelcometoArcanon.wav",
        "https://raw.githubusercontent.com/RealmCraftStudios/Kingdoms-of-Arcanon/main/CreationofArcanon.wav",
        "https://raw.githubusercontent.com/RealmCraftStudios/Kingdoms-of-Arcanon/main/ComingofDarnkess.wav",
        "https://raw.githubusercontent.com/RealmCraftStudios/Kingdoms-of-Arcanon/main/TheNinePlagues.wav",
        "https://raw.githubusercontent.com/RealmCraftStudios/Kingdoms-of-Arcanon/main/TheDarkTimes.wav",
        "https://raw.githubusercontent.com/RealmCraftStudios/Kingdoms-of-Arcanon/main/GreatWarArcanon.wav"
    ];

    function playCurrentTrack() {
        audioPlayer.src = tracks[currentTrackIndex];
        audioPlayer.play();
    }

    nextButton.addEventListener('click', function() {
        currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
        playCurrentTrack();
    });

    prevButton.addEventListener('click', function() {
        currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
        playCurrentTrack();
    });

    playCurrentTrack();

    audioPlayer.volume = 0.75;

    function stopBackgroundMusic() {
        audioPlayer.pause();
        audioPlayer.currentTime = 0;
    }

    function showMainContent(pageId) {
        const iframeSrc = getIframeSrc(pageId);
        splashScreen.classList.add('fade-to-black');
        setTimeout(() => {
            splashScreen.classList.add('fade-out');
            mainContent.classList.add('show');
            stopBackgroundMusic();
            mainContent.innerHTML = `
                <div class="page-title">
                    <a href="#" onclick="location.reload();">Kingdoms of Arcanon Game Data</a>
                </div>
                <div class="page-subtitle" id="subtitle-${pageId}">
                    <a href="#" class="page-link" data-page="character-cards">Character Cards</a>
                    <a href="#" class="page-link" data-page="attack-cards">Attack Cards</a>
                    <a href="#" class="page-link" data-page="defense-cards">Defense Cards</a>
                    <a href="#" class="page-link" data-page="item-cards">Item Cards</a>
                    <a href="#" class="page-link" data-page="resource-cards">Resource Cards</a>
                    <a href="#" class="page-link" data-page="ruler-cards">Ruler Cards</a>
                    <a href="#" class="page-link" data-page="rulebook">Rulebook</a>
                    <a href="#" class="page-link" data-page="world-history">World History</a>
                    <a href="#" class="page-link" data-page="set-info">Set Info</a>
                </div>
                <iframe referrerpolicy="no-referrer-when-downgrade" src="${iframeSrc}" style="width: 100%; height: calc(100% - 80px); border: none;"></iframe>
            `;
            attachLinkListeners();
        }, 1000);
    }

    function getIframeSrc(pageId) {
        switch (pageId) {
            case 'character-cards':
                return 'CharacterCards/index.html';
            case 'attack-cards':
                return 'AttackCards/index.html';
            case 'defense-cards':
                return 'DefenseCards/index.html';
            case 'item-cards':
                return 'ItemCards/index.html';
            case 'resource-cards':
                return 'ResourceCards/index.html';
            case 'ruler-cards':
                return 'RulerCards/index.html';
            case 'rulebook':
                return 'Rulebook/index.html';
            case 'world-history':
                return 'WorldHistory/index.html';
            case 'set-info':
                return 'SetInfo/index.html';
            default:
                return '';
        }
    }

    function attachLinkListeners() {
        const pageLinks = document.querySelectorAll('.page-link');
        pageLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pageId = this.getAttribute('data-page');
                showMainContent(pageId);
            });
        });
    }

    attachLinkListeners();

    // Search functionality
    const searchInput = document.createElement('input');
    searchInput.setAttribute('type', 'text');
    searchInput.setAttribute('class', 'search-input');
    searchInput.setAttribute('placeholder', 'Search...');
    searchInput.addEventListener('input', function() {
        const searchText = this.value.trim().toLowerCase();
        const subtitles = document.querySelectorAll('.page-subtitle');
        subtitles.forEach(subtitle => {
            const pageId = subtitle.id.split('-')[1];
            const links = subtitle.querySelectorAll('.page-link');
            links.forEach(link => {
                const linkText = link.textContent.trim().toLowerCase();
                if (linkText.includes(searchText)) {
                    link.style.display = 'inline-block';
                } else {
                    link.style.display = 'none';
                }
            });
        });
    });

    const searchContainer = document.createElement('div');
    searchContainer.setAttribute('class', 'search-container');
    searchContainer.appendChild(searchInput);
    mainContent.appendChild(searchContainer); // Append to main content, not splash screen

});
</script>
